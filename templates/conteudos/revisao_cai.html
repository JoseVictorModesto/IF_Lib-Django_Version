{% extends 'bases_templates/base/base_conteudo.html' %}
{% load static %}
{% block content %}

    <main class="main_user">
        <h1 class="titulo_pag_caixa">Revisão do conteúdo: {{ conteudo_a_revisar.titulo|slice:":60" }}{% if conteudo_a_revisar.titulo|length > 60 %}...{% endif %}</h1>
        <form class="form_cad_cont" action="{% url 'revisao_cai' conteudo_a_revisar.id %}" method="POST">

            {% csrf_token %}

            <div class="form_cad_cont_part">
                <div class="infor_cad_part">
                    <h1 class="titulo_form num_ti"><i class="bi bi-file-earmark-break"></i></h1>
                    <h1 class="titulo_form">Informe o que deve ser modificado no conteúdo</h1>
                </div>

                <!-- editor de revisão -->
                <div class="container editor_texto">
                    <label class="label_editor">Texto de revisão *</label>
                    <div id="editor"></div>
                    <input type="hidden" name="texto_editor_revisao" id="texto_editor_revisao">
                </div>
                <h2 style="color: #D9D9D9; font-size: 0.8em; font-family: Inter, sans-serif; font-weight: 300; margin-top: 10px;">( * Campo obrigatório no formulário. )</h2>
            </div>

            <div class="form_confirm">
                <button class="bota_cad_cont enviar_cont" type="submit" onclick="return salvar_texto()">Enviar</button>
                <a href="{% url 'vizualizar_cai_nao_valid' conteudo_a_revisar.id %}" class="bota_cad_cont cancelar_cont" style="text-decoration: none;">Retornar</a>
            </div>
        </form>

    </main>

    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>

    <!-- JS do editor quill -->
    <script>
        // importar fontes a serem usadas
        var Font = Quill.import('formats/font');
        Font.whitelist = ['arial'];
        Quill.register(Font, true);

        // opcoes da toolbar
        var toolbarOptions = [
            ['bold', 'italic', 'underline'],
            ['blockquote', 'code-block'],

            [{'font': ['arial'] }],
            [{'align': [] }],

            ['clean']
        ];

        // inicia um novo quill (editor)
        var quill = new Quill('#editor', {

            modules: {
                toolbar: {
                    container: toolbarOptions
                }
            },
            placeholder: 'Digite do que deve ser revisado no conteúdo',
            theme: 'snow'
        });

        function salvar_texto() {
            // pega o conteudo digitado no editor e armazena na variavel conteudo_editor
            var conteudo_editor_revisao = quill.root.innerHTML;

            // esse trecho coloca o conteudo do editor Quill (conteudo_editor_revisao) no input com id=texto_editor_revisao do formulario, para que ele possa ser enviado ao Django
            // (<input type="hidden" name="texto_editor_revisao" id="texto_editor_revisao">)
            var hiddenInputRevisao = document.getElementById('texto_editor_revisao');
            
            // verifica se este vazio
            if (conteudo_editor_revisao === '<p><br></p>' || conteudo_editor_revisao === '') {
                alert('Insira as informações de revisão para prosseguir.');
                return false;
            }
            
            if (hiddenInputRevisao) {
                hiddenInputRevisao.value = conteudo_editor_revisao;
            }
            // retorna true para permitir o envio normal do formulario
            return true;
        }

    </script>

{% endblock %}